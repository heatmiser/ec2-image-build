name: Satellite
description: Install Red Hat Satellite
schemaVersion: 1.0
constants:
  - rh_acct:
      type: string
      value: <org-id>

phases:
  - name: build
    steps:
      - name: InstallGit
        action: ExecuteBash
        inputs:
          commands:
            - yum install -y git

      - name: InstallEPEL
        action: ExecuteBash
        inputs:
          commands:
            - curl -O https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
            - yum install -y epel-release-latest-7.noarch.rpm

      - name: InstallAnsible
        action: ExecuteBash
        inputs:
          commands:
            - yum install -y ansible

      - name: RemoveEPEL
        action: ExecuteBash
        inputs:
          commands:
            - yum remove -y epel-release

      - name: CloneRepo
        action: ExecuteBash
        inputs:
          commands:
            - git clone https://github.com/willtome/ec2-image-build.git
            - cd ec2-image-build
            - ./scripts/install_collections.sh

      - name: RunPlaybook
        action: ExecuteBash
        inputs:
          commands:
            - ansible-playbook ec2-image-build/ansible/satellite.yml -e org_id={{rh_acct}}
